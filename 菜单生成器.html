<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èœå•ç”Ÿæˆå™¨ - æ”¯æŒExcelä¸‹è½½</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e1e5eb;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        .description {
            color: #7f8c8d;
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .controls {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            justify-content: center;
        }
        
        .control-group {
            flex: 1;
            min-width: 300px;
        }
        
        h2 {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        select, button {
            width: 100%;
            padding: 12px 15px;
            border-radius: 6px;
            border: 1px solid #d1d9e6;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        select {
            background-color: white;
            cursor: pointer;
        }
        
        select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .primary-btn {
            background-color: #2ecc71;
            color: white;
            border: none;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .primary-btn:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        
        .secondary-btn {
            background-color: #3498db;
            color: white;
            border: none;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .secondary-btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .menu-container {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            overflow-x: auto;
            margin-bottom: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th {
            background-color: #3498db;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e1e5eb;
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tr:hover {
            background-color: #f1f8ff;
        }
        
        .category-header {
            background-color: #2c3e50;
            color: white;
            font-weight: bold;
        }
        
        .total-row {
            background-color: #ecf0f1;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .total-count {
            color: #e74c3c;
            font-size: 1.2rem;
        }
        
        .note {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #3498db;
            font-size: 0.95rem;
            color: #555;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #95a5a6;
            font-size: 0.9rem;
        }
        
        .download-section {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            text-align: center;
            margin-top: 20px;
        }
        
        .download-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            font-weight: 600;
            cursor: pointer;
            padding: 15px 30px;
            border-radius: 6px;
            font-size: 1.1rem;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .download-btn:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .download-btn i {
            font-size: 1.3rem;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }
            
            .control-group {
                min-width: 100%;
            }
            
            table {
                font-size: 0.9rem;
            }
            
            th, td {
                padding: 10px 8px;
            }
        }
    </style>
    <!-- å¼•å…¥SheetJSåº“ç”¨äºç”ŸæˆExcelæ–‡ä»¶ -->
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <header>
        <h1>æ™ºèƒ½èœå•ç”Ÿæˆå™¨</h1>
        <p class="description">æ ¹æ®è€æ€»æ˜¯å¦å‚ä¸å’Œå°±é¤äººæ•°è‡ªåŠ¨ç”Ÿæˆåˆé€‚çš„èœå•ã€‚</p>
    </header>
    
    <div class="controls">
        <div class="control-group">
            <h2>å°±é¤æ¡ä»¶è®¾ç½®</h2>
            <label for="boss-attendance">è€æ€»æ˜¯å¦å‚ä¸å°±é¤ï¼Ÿ</label>
            <select id="boss-attendance">
                <option value="participate">è€æ€»å‚ä¸å°±é¤</option>
                <option value="not-participate">è€æ€»ä¸å‚ä¸å°±é¤</option>
            </select>
        </div>
        
        <div class="control-group">
            <h2>å°±é¤äººæ•°è®¾ç½®</h2>
            <label for="diner-count">è¯·é€‰æ‹©å°±é¤äººæ•°</label>
            <select id="diner-count">
                <option value="6">6äºº</option>
                <option value="7">7äºº</option>
                <option value="8">8äºº</option>
                <option value="9">9äºº</option>
                <option value="10">10äºº</option>
                <option value="11" selected>11äºº</option>
                <option value="12">12äºº</option>
            </select>
        </div>
        
        <div class="control-group">
            <h2>èœå•æ“ä½œ</h2>
            <button id="generate-btn" class="primary-btn">ç”Ÿæˆèœå•</button>
            <p class="note">è¯·ç‚¹å‡»æŒ‰é’®ï¼Œå°†æ ¹æ®æ‚¨çš„é€‰æ‹©ç”Ÿæˆèœå•ã€‚</p>
        </div>
    </div>
    
    <div class="menu-container">
        <h2>ç”Ÿæˆçš„èœå•</h2>
        <div id="menu-table-container">
            <!-- èœå•è¡¨æ ¼å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            <p style="text-align: center; color: #7f8c8d; padding: 30px;">è¯·è®¾ç½®å°±é¤æ¡ä»¶å¹¶ç‚¹å‡»"ç”Ÿæˆèœå•"æŒ‰é’®</p>
        </div>
    </div>
    
    <div class="download-section" id="download-section" style="display: none;">
        <h2>ä¸‹è½½èœå•</h2>
        <p style="margin-bottom: 20px;">èœå•å·²ç”Ÿæˆï¼Œæ‚¨å¯ä»¥ä¸‹è½½Excelæ–‡ä»¶</p>
        <button id="download-btn" class="download-btn">
            <span>ğŸ“¥</span> ä¸‹è½½Excelèœå•
        </button>
        <p class="note" style="margin-top: 15px;">ä¸‹è½½çš„Excelæ–‡ä»¶å°†åŒ…å«å®Œæ•´çš„èœå•ä¿¡æ¯ï¼Œå¯ç›´æ¥æ‰“å°æˆ–åˆ†äº«ã€‚</p>
    </div>
    
    <div class="footer">
        <p>æ™ºèƒ½èœå•ç”Ÿæˆå™¨ Â© 2023 | æ ¹æ®å°±é¤æ¡ä»¶å’Œäººæ•°è‡ªåŠ¨ç”Ÿæˆåˆé€‚èœå•</p>
    </div>

    <script>
        // èœå“åº“æ•°æ®
        const dishes = {
            "å†·èœï¼ˆè¤ï¼‰": ["ç‰›è…±å­", "å’¸èŸ¹", "ç™½åˆ‡é¸¡", "ç™½åˆ‡ç‰›è‚š", "å†»ç¾Šè‚‰", "ç‰›è‚‰æ‹¼ç›˜", "ç³Ÿé¸¡", "çŒªèˆŒ", "ç³Ÿé¸­", "ç³Ÿè‚‰", "ç™½åˆ‡ç¾Šè‚‰", "çƒ¤é¸­", "è–°é±¼"],
            "å†·èœï¼ˆç´ ï¼‰": ["éº»æ²¹è´ç¬‹", "å“é“ƒ", "è…°æœ", "çº¢æ£", "ç³–é†‹è—•"],
            "ç‚’èœï¼ˆè¤ï¼‰": ["ç™½ç‰è‡ç‚’é²é±¼ç‰‡", "é’æ¤’ç‰›ç­‹", "ç”œæ¤’ç‰›è‚‰", "èŠ¹èœè‚‰ä¸", "èŠ¹èœç‰›è‚‰", "ç™½èœç‚’è‚‰", "é²é±¼ç‚’ç™½ç‰è‡", "çº¢çƒ§è›å­", "çº¢çƒ§é±¼", "çº¢çƒ§é±¼å¤´", "çšç™½ç‰›ç­‹", "éŸ­èœèŠ±ç‰›è‚‰", "èŠ¹èœé±¿é±¼", "å±±è¯ç‰›æ’", "é…¸èœç™½è‚š", "è´ç¬‹é²é±¼ç‰‡", "äº”èŠ±è‚‰å·åœŸè±†", "é›ªèœé²ˆé±¼", "æ²¹çˆ†æ²³è™¾", "æ¦¨èœèŠ¯ç‚’é±¿é±¼", "çº¢çƒ§å¸¦é±¼", "çº¢çƒ§å­é±¼", "è‘±æ²¹é»„é±¼", "é…±æ²¹æ²³è™¾", "è…Šè‚‰ç‚’è±†è§’", "ç‰›ç™¾å¶ç…²"],
            "ç‚’èœï¼ˆç´ ï¼‰": ["é¦™è‡é’èœ", "å’¸ç™½èœç‚’å†¬ç¬‹", "æ¢…å¹²èœå››å­£è±†", "è‚‰æ²«èŒ„å­", "ç™½ç‰è‡ç‚’æ¯›è±†", "é†‹æºœç™½èœ", "è’¿èœ", "é…±è‚‰ç‚’è±†è§’", "æ¯›ç¬‹ç‚’é›ªèœ", "è’œè“‰è èœ", "è’œè“‰èŠ±èœ", "è’œè“‰ç»¿èŠ±èœ", "è’œè“‰ç”Ÿèœ", "è’œè“‰å¨ƒå¨ƒèœ", "ç¬‹å¹²èœè’²å­", "è´ç¬‹ç‚’é¦™è‡", "è’œè“‰æ²¹éº¦èœ", "å’¸è›‹å—ç“œ"],
            "ç‚–èœ": ["æ²¹è±†è…åŒ…å’¸èœ", "èåœç‰›æ’", "åœŸè±†é—·ç‰›è…©", "å°æ’è‚‰", "ç”²é±¼ç…²", "æ’éª¨ç…²"],
            "ä¸‹é¥­èœ": ["è·å…°è±†ç‚’è…Šè‚ ", "è…Šè‚‰æ‰è±†", "é›ªèœé±¿é±¼", "æ¦¨èœå¿ƒç‚’ç¬‹è‚‰ç‰‡", "æ¸…è’¸å’¸è‚‰", "æ¸…è’¸å’¸è‚‰ç†è‚ ", "è’¸å’¸é±¼"],
            "æ±¤": ["é¸¡è‚‰èŒè‡æ±¤", "ä¸‰é²œæ±¤", "æ¦¨èœä¸ç¬‹æ±¤", "æ¦¨èœä¸æ±¤", "æ¦¨èœèŒ­ç™½æ±¤", "ç´«èœè›‹æ±¤"],
            "ç³•ç‚¹": ["é¥ºå­", "å¥¶é»„åŒ…"],
            "æ°´æœ": ["å°ç•ªèŒ„", "å“ˆå¯†ç“œ", "è èèœœ"],
            "ä¸€ç±»ç¡¬èœ": ["çº¢çƒ§è¹„è†€", "æ¡¥æ’", "çº¢çƒ§è‚‰"],
            "äºŒç±»ç¡¬èœ": ["çº¢çƒ§ç‰›æ’", "çº¢çƒ§ç¾Šæ’", "é¸­ç…²"],
            "è€æ€»çˆ±åƒç±»": ["é¦™ç…å¸¦é±¼", "é¦™ç…å¤§é²³é±¼", "çº¢çƒ§è¹„è†€", "çº¢çƒ§è‚‰", "ç™½åˆ‡äº”èŠ±è‚‰ï¼ˆåšåˆ‡ï¼Œé…è°ƒæ–™ï¼‰", "çƒ¤çº¢è–¯", "é›ªèœç¬‹ä¸ç±³é±¼", "çº¢çƒ§æ–°é²œå¸¦é±¼ï¼ˆä¸æ–°é²œä¸è¦ï¼‰"],
            "è’¸èœ": ["å£è˜‘è’¸é¸Ÿè›‹", "è‘±æ²¹æ¯›è‚š", "è‘±æ²¹é²é±¼", "è‘±æ²¹ç‰›ç™¾å¶", "è·å¶é³—", "è‘±æ²¹èŠ‹å¤´"]
        };

        // èœå“æ•°é‡è§„åˆ™
        const rules = {
            "not-participate": {
                6: {"å†·èœï¼ˆè¤ï¼‰": 1, "å†·èœï¼ˆç´ ï¼‰": 1, "ç‚’èœï¼ˆè¤ï¼‰": 3, "ç‚’èœï¼ˆç´ ï¼‰": 1, "ç‚–èœ": 1, "ä¸‹é¥­èœ": 1, "ä¸€ç±»ç¡¬èœ": 0, "äºŒç±»ç¡¬èœ": 1, "è€æ€»çˆ±åƒç±»": 0, "æ±¤": 1, "ç³•ç‚¹": 1, "æ°´æœ": 1},
                7: {"å†·èœï¼ˆè¤ï¼‰": 2, "å†·èœï¼ˆç´ ï¼‰": 1, "ç‚’èœï¼ˆè¤ï¼‰": 3, "ç‚’èœï¼ˆç´ ï¼‰": 2, "ç‚–èœ": 1, "ä¸‹é¥­èœ": 1, "ä¸€ç±»ç¡¬èœ": 0, "äºŒç±»ç¡¬èœ": 1, "è€æ€»çˆ±åƒç±»": 0, "æ±¤": 1, "ç³•ç‚¹": 1, "æ°´æœ": 1},
                8: {"å†·èœï¼ˆè¤ï¼‰": 2, "å†·èœï¼ˆç´ ï¼‰": 1, "ç‚’èœï¼ˆè¤ï¼‰": 3, "ç‚’èœï¼ˆç´ ï¼‰": 2, "ç‚–èœ": 2, "ä¸‹é¥­èœ": 1, "ä¸€ç±»ç¡¬èœ": 1, "äºŒç±»ç¡¬èœ": 0, "è€æ€»çˆ±åƒç±»": 0, "æ±¤": 1, "ç³•ç‚¹": 1, "æ°´æœ": 1},
                9: {"å†·èœï¼ˆè¤ï¼‰": 3, "å†·èœï¼ˆç´ ï¼‰": 1, "ç‚’èœï¼ˆè¤ï¼‰": 4, "ç‚’èœï¼ˆç´ ï¼‰": 2, "ç‚–èœ": 2, "ä¸‹é¥­èœ": 1, "ä¸€ç±»ç¡¬èœ": 1, "äºŒç±»ç¡¬èœ": 0, "è€æ€»çˆ±åƒç±»": 0, "æ±¤": 1, "ç³•ç‚¹": 1, "æ°´æœ": 1},
                10: {"å†·èœï¼ˆè¤ï¼‰": 3, "å†·èœï¼ˆç´ ï¼‰": 1, "ç‚’èœï¼ˆè¤ï¼‰": 4, "ç‚’èœï¼ˆç´ ï¼‰": 2, "ç‚–èœ": 2, "ä¸‹é¥­èœ": 2, "ä¸€ç±»ç¡¬èœ": 1, "äºŒç±»ç¡¬èœ": 1, "è€æ€»çˆ±åƒç±»": 0, "æ±¤": 1, "ç³•ç‚¹": 1, "æ°´æœ": 1},
                11: {"å†·èœï¼ˆè¤ï¼‰": 3, "å†·èœï¼ˆç´ ï¼‰": 1, "ç‚’èœï¼ˆè¤ï¼‰": 4, "ç‚’èœï¼ˆç´ ï¼‰": 2, "ç‚–èœ": 3, "ä¸‹é¥­èœ": 2, "ä¸€ç±»ç¡¬èœ": 1, "äºŒç±»ç¡¬èœ": 1, "è€æ€»çˆ±åƒç±»": 0, "æ±¤": 1, "ç³•ç‚¹": 1, "æ°´æœ": 1},
                12: {"å†·èœï¼ˆè¤ï¼‰": 3, "å†·èœï¼ˆç´ ï¼‰": 2, "ç‚’èœï¼ˆè¤ï¼‰": 5, "ç‚’èœï¼ˆç´ ï¼‰": 2, "ç‚–èœ": 3, "ä¸‹é¥­èœ": 2, "ä¸€ç±»ç¡¬èœ": 1, "äºŒç±»ç¡¬èœ": 1, "è€æ€»çˆ±åƒç±»": 0, "æ±¤": 1, "ç³•ç‚¹": 1, "æ°´æœ": 1}
            },
            "participate": {
                6: {"å†·èœï¼ˆè¤ï¼‰": 1, "å†·èœï¼ˆç´ ï¼‰": 1, "ç‚’èœï¼ˆè¤ï¼‰": 2, "ç‚’èœï¼ˆç´ ï¼‰": 1, "ç‚–èœ": 1, "ä¸‹é¥­èœ": 1, "ä¸€ç±»ç¡¬èœ": 0, "äºŒç±»ç¡¬èœ": 1, "è€æ€»çˆ±åƒç±»": 1, "æ±¤": 1, "ç³•ç‚¹": 1, "æ°´æœ": 1},
                7: {"å†·èœï¼ˆè¤ï¼‰": 2, "å†·èœï¼ˆç´ ï¼‰": 1, "ç‚’èœï¼ˆè¤ï¼‰": 2, "ç‚’èœï¼ˆç´ ï¼‰": 2, "ç‚–èœ": 1, "ä¸‹é¥­èœ": 1, "ä¸€ç±»ç¡¬èœ": 0, "äºŒç±»ç¡¬èœ": 1, "è€æ€»çˆ±åƒç±»": 1, "æ±¤": 1, "ç³•ç‚¹": 1, "æ°´æœ": 1},
                8: {"å†·èœï¼ˆè¤ï¼‰": 2, "å†·èœï¼ˆç´ ï¼‰": 1, "ç‚’èœï¼ˆè¤ï¼‰": 2, "ç‚’èœï¼ˆç´ ï¼‰": 2, "ç‚–èœ": 2, "ä¸‹é¥­èœ": 1, "ä¸€ç±»ç¡¬èœ": 1, "äºŒç±»ç¡¬èœ": 0, "è€æ€»çˆ±åƒç±»": 1, "æ±¤": 1, "ç³•ç‚¹": 1, "æ°´æœ": 1},
                9: {"å†·èœï¼ˆè¤ï¼‰": 3, "å†·èœï¼ˆç´ ï¼‰": 1, "ç‚’èœï¼ˆè¤ï¼‰": 2, "ç‚’èœï¼ˆç´ ï¼‰": 2, "ç‚–èœ": 2, "ä¸‹é¥­èœ": 1, "ä¸€ç±»ç¡¬èœ": 1, "äºŒç±»ç¡¬èœ": 0, "è€æ€»çˆ±åƒç±»": 2, "æ±¤": 1, "ç³•ç‚¹": 1, "æ°´æœ": 1},
                10: {"å†·èœï¼ˆè¤ï¼‰": 3, "å†·èœï¼ˆç´ ï¼‰": 1, "ç‚’èœï¼ˆè¤ï¼‰": 2, "ç‚’èœï¼ˆç´ ï¼‰": 2, "ç‚–èœ": 2, "ä¸‹é¥­èœ": 2, "ä¸€ç±»ç¡¬èœ": 1, "äºŒç±»ç¡¬èœ": 1, "è€æ€»çˆ±åƒç±»": 2, "æ±¤": 1, "ç³•ç‚¹": 1, "æ°´æœ": 1},
                11: {"å†·èœï¼ˆè¤ï¼‰": 3, "å†·èœï¼ˆç´ ï¼‰": 1, "ç‚’èœï¼ˆè¤ï¼‰": 2, "ç‚’èœï¼ˆç´ ï¼‰": 2, "ç‚–èœ": 3, "ä¸‹é¥­èœ": 2, "ä¸€ç±»ç¡¬èœ": 1, "äºŒç±»ç¡¬èœ": 1, "è€æ€»çˆ±åƒç±»": 2, "æ±¤": 1, "ç³•ç‚¹": 1, "æ°´æœ": 1},
                12: {"å†·èœï¼ˆè¤ï¼‰": 3, "å†·èœï¼ˆç´ ï¼‰": 2, "ç‚’èœï¼ˆè¤ï¼‰": 3, "ç‚’èœï¼ˆç´ ï¼‰": 2, "ç‚–èœ": 3, "ä¸‹é¥­èœ": 2, "ä¸€ç±»ç¡¬èœ": 1, "äºŒç±»ç¡¬èœ": 1, "è€æ€»çˆ±åƒç±»": 2, "æ±¤": 1, "ç³•ç‚¹": 1, "æ°´æœ": 1}
            }
        };

        // å­˜å‚¨å½“å‰ç”Ÿæˆçš„èœå•æ•°æ®
        let currentMenuData = [];
        let totalDishes = 0;
        let bossAttendance = "";
        let dinerCount = 0;

        // ä»æ•°ç»„ä¸­éšæœºé€‰æ‹©ä¸é‡å¤çš„å…ƒç´ 
        function getRandomItems(array, count) {
            if (count > array.length) {
                console.warn(`è¯·æ±‚çš„æ•°é‡(${count})å¤§äºæ•°ç»„é•¿åº¦(${array.length})ï¼Œè¿”å›æ‰€æœ‰å…ƒç´ `);
                return [...array];
            }
            
            const shuffled = [...array].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        // ç”Ÿæˆèœå•
        function generateMenu() {
            bossAttendance = document.getElementById('boss-attendance').value;
            dinerCount = parseInt(document.getElementById('diner-count').value);
            
            // è·å–å¯¹åº”çš„è§„åˆ™
            const rule = rules[bossAttendance][dinerCount];
            
            // ç”¨äºè·Ÿè¸ªå·²é€‰æ‹©çš„èœå“ï¼Œé¿å…é‡å¤
            const selectedDishes = new Set();
            
            // é‡ç½®èœå•æ•°æ®
            currentMenuData = [];
            totalDishes = 0;
            
            // å¯¹æ¯ä¸ªç±»åˆ«é€‰æ‹©èœå“
            for (const [category, count] of Object.entries(rule)) {
                if (count === 0) continue;
                
                // è·å–è¯¥ç±»åˆ«æ‰€æœ‰å¯ç”¨çš„èœå“
                const availableDishes = dishes[category].filter(dish => !selectedDishes.has(dish));
                
                // éšæœºé€‰æ‹©æŒ‡å®šæ•°é‡çš„èœå“
                const selected = getRandomItems(availableDishes, count);
                
                // æ·»åŠ åˆ°å·²é€‰æ‹©é›†åˆä¸­
                selected.forEach(dish => selectedDishes.add(dish));
                
                // æ·»åŠ åˆ°èœå•æ•°æ®ä¸­
                currentMenuData.push({
                    category,
                    count,
                    dishes: selected
                });
                
                totalDishes += count;
            }
            
            // æ¸²æŸ“èœå•è¡¨æ ¼
            renderMenuTable();
            
            // æ˜¾ç¤ºä¸‹è½½åŒºåŸŸ
            document.getElementById('download-section').style.display = 'block';
        }

        // æ¸²æŸ“èœå•è¡¨æ ¼
        function renderMenuTable() {
            const container = document.getElementById('menu-table-container');
            
            // åˆ›å»ºè¡¨æ ¼
            let html = `
                <div class="note">
                    å½“å‰æ¡ä»¶ï¼š<strong>${bossAttendance === 'participate' ? 'è€æ€»å‚ä¸å°±é¤' : 'è€æ€»ä¸å‚ä¸å°±é¤'}</strong>ï¼Œå°±é¤äººæ•°ï¼š<strong>${dinerCount}äºº</strong>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th width="25%">ç±»åˆ«</th>
                            <th width="15%">èœå“æ•°é‡</th>
                            <th width="60%">èœå“åç§°</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            // æ·»åŠ æ¯ä¸ªç±»åˆ«çš„èœå“
            currentMenuData.forEach(item => {
                html += `
                    <tr class="category-header">
                        <td>${item.category}</td>
                        <td>${item.count}ä¸ª</td>
                        <td></td>
                    </tr>
                `;
                
                // æ·»åŠ è¯¥ç±»åˆ«çš„æ¯ä¸ªèœå“
                item.dishes.forEach(dish => {
                    html += `
                        <tr>
                            <td></td>
                            <td></td>
                            <td>${dish}</td>
                        </tr>
                    `;
                });
            });
            
            // æ·»åŠ æ€»è®¡è¡Œ
            html += `
                    <tr class="total-row">
                        <td><strong>æ€»è®¡</strong></td>
                        <td class="total-count"><strong>${totalDishes}ä¸ª</strong></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
            `;
            
            container.innerHTML = html;
        }

        // ç”Ÿæˆå¹¶ä¸‹è½½Excelæ–‡ä»¶
        function downloadExcel() {
            // åˆ›å»ºExcelå·¥ä½œç°¿
            const wb = XLSX.utils.book_new();
            
            // å‡†å¤‡Excelæ•°æ®
            const excelData = [];
            
            // æ·»åŠ æ ‡é¢˜è¡Œ
            excelData.push(["èœå•è¯¦æƒ…", "", ""]);
            excelData.push(["ç”Ÿæˆæ¡ä»¶", `${bossAttendance === 'participate' ? 'è€æ€»å‚ä¸å°±é¤' : 'è€æ€»ä¸å‚ä¸å°±é¤'}ï¼Œå°±é¤äººæ•°ï¼š${dinerCount}äºº`, ""]);
            excelData.push([]); // ç©ºè¡Œ
            excelData.push(["ç±»åˆ«", "èœå“æ•°é‡", "èœå“åç§°"]);
            
            // æ·»åŠ æ¯ä¸ªç±»åˆ«çš„æ•°æ®
            currentMenuData.forEach(item => {
                // ç±»åˆ«æ ‡é¢˜è¡Œ
                excelData.push([item.category, item.count, ""]);
                
                // èœå“è¡Œ
                item.dishes.forEach(dish => {
                    excelData.push(["", "", dish]);
                });
            });
            
            // æ€»è®¡è¡Œ
            excelData.push([]); // ç©ºè¡Œ
            excelData.push(["æ€»è®¡", totalDishes, ""]);
            
            // åˆ›å»ºå·¥ä½œè¡¨
            const ws = XLSX.utils.aoa_to_sheet(excelData);
            
            // è®¾ç½®åˆ—å®½
            const wscols = [
                { wch: 15 }, // ç¬¬ä¸€åˆ—å®½åº¦
                { wch: 12 }, // ç¬¬äºŒåˆ—å®½åº¦
                { wch: 40 }  // ç¬¬ä¸‰åˆ—å®½åº¦
            ];
            ws['!cols'] = wscols;
            
            // åˆå¹¶æ ‡é¢˜å•å…ƒæ ¼
            ws['!merges'] = [
                { s: { r: 0, c: 0 }, e: { r: 0, c: 2 } }, // åˆå¹¶ç¬¬ä¸€è¡Œ
                { s: { r: 1, c: 0 }, e: { r: 1, c: 2 } }  // åˆå¹¶ç¬¬äºŒè¡Œ
            ];
            
            // å°†å·¥ä½œè¡¨æ·»åŠ åˆ°å·¥ä½œç°¿
            XLSX.utils.book_append_sheet(wb, ws, "èœå•");
            
            // ç”ŸæˆExcelæ–‡ä»¶å¹¶ä¸‹è½½
            const fileName = `èœå•_${bossAttendance === 'participate' ? 'è€æ€»å‚ä¸' : 'è€æ€»ä¸å‚ä¸'}_${dinerCount}äºº_${new Date().getTime()}.xlsx`;
            XLSX.writeFile(wb, fileName);
        }

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            // ç»‘å®šç”ŸæˆæŒ‰é’®äº‹ä»¶
            document.getElementById('generate-btn').addEventListener('click', generateMenu);
            
            // ç»‘å®šä¸‹è½½æŒ‰é’®äº‹ä»¶
            document.getElementById('download-btn').addEventListener('click', downloadExcel);
            
            // åˆå§‹ç”Ÿæˆä¸€ä¸ªèœå•ï¼ˆé»˜è®¤æ¡ä»¶ï¼šè€æ€»å‚ä¸ï¼Œ11äººï¼‰
            generateMenu();
        });
    </script>
</body>
</html>